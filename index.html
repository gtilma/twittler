<!DOCTYPE html>
<html>
  <head>
    <title>Twittler: Twitter... with an L</title>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato:400, 700">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
    <meta name="viewport" content="width=device-width">
  </head>
  <body>
    <script>

      $(document).ready(function(){
        // Function to insert tweet
        var insertTweet = function() {
          var tweet = streams.home[index];
          var $tweet = $('<div class="tweet"></div>');

          var $tweeter = $('<a href="#" class="tweeter"></a>');
          $tweeter.text('@' + tweet.user);
          $tweeter.prependTo($tweet);

          var $message = $('<div class="message"></div>');
          $message.text(tweet.message);
          $message.appendTo($tweet);

          var $timestamp = $('<div class="timestamp"></div>');
          $timestamp.text(jQuery.timeago(tweet.created_at));
          $timestamp.appendTo($tweet);

          // User's tweets
          var $tweetStream = $('<div class="tweetStream"></div>');

          var username = tweet.user;
          var j = streams.users[username].length - 1;
          while (j >= 0) {
            var subTweet = streams.users[username][j];
            var $subTweet = $('<div class="subTweet"></div>');

            var $subMessage = $('<div class="subMessage"></div>');
            $subMessage.text(subTweet.message);
            $subMessage.appendTo($subTweet);

            var $subTimestamp = $('<div class="subTimestamp"></div>');
            $subTimestamp.text(jQuery.timeago(subTweet.created_at));
            $subTimestamp.appendTo($subTweet);

            $subTweet.appendTo($tweetStream);

            j -= 1;
          }

          $tweetStream.appendTo($tweet);
          $tweet.appendTo($body);
        };

        var $body = $('body');
        $body.html('');

        var headerImg = 'twittler.png';
        var $header = $('<header class="banner"><img src="' + headerImg + '" alt=""></header>');
        $header.appendTo($body);

        var $newTweets = $('<button class="newTweets""></button>');
        $newTweets.text('New Tweets');
        $newTweets.appendTo($header);

        var index = streams.home.length - 1;
        while (index >= 0) {
          insertTweet();
          index -= 1;
        }

        $('.newTweets').click(function() {
          var latest = streams.home.length - 1;
          var tweet = streams.home[latest];
          var $tweet = $('<div class="tweet"></div>');

          var $tweeter = $('<a href="#" class="tweeter"></a>');
          $tweeter.text('@' + tweet.user);
          $tweeter.prependTo($tweet);

          var $message = $('<div class="message"></div>');
          $message.text(tweet.message);
          $message.appendTo($tweet);

          var $timestamp = $('<div class="timestamp"></div>');
          $timestamp.text(jQuery.timeago(tweet.created_at));
          $timestamp.appendTo($tweet);

          // User's tweets
          var $tweetStream = $('<div class="tweetStream"></div>');
          var username = tweet.user;
          var j = streams.users[username].length - 1;
          while (j >= 0) {
            var subTweet = streams.users[username][j];
            var $subTweet = $('<div class="subTweet"></div>');

            var $subMessage = $('<div class="subMessage"></div>');
            $subMessage.text(subTweet.message);
            $subMessage.appendTo($subTweet);

            var $subTimestamp = $('<div class="subTimestamp"></div>');
            $subTimestamp.text(jQuery.timeago(subTweet.created_at));
            $subTimestamp.appendTo($subTweet);

            $subTweet.appendTo($tweetStream);

            j -= 1;
          }
          $tweetStream.appendTo($tweet);

          $tweet.insertAfter($header);
          $('.tweet').first().hide().slideDown();
        });

        $('.tweeter').click(function() {
          $(this).siblings('.tweetStream').slideToggle();
        });

      });

    </script>
  </body>
</html>
